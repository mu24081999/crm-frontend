(self.webpackChunkclient=self.webpackChunkclient||[]).push([[2816],{56874:(e,s,a)=>{"use strict";a.d(s,{A:()=>i});a(82483);var t=a(28846),l=a(56723);const i=function(e){let s,{fileType:a,fileUrl:i,fileWidth:n}=e;switch(a){case"jpeg":case"png":case"jpg":s=(0,l.jsx)("img",{className:"img-fluid rounded",style:{maxWidth:"300px"},src:i,width:n,alt:" preview"});break;case"pdf":s=(0,l.jsx)(t.kl1,{});break;case"zip":s=(0,l.jsx)(t.aw1,{});break;case"video":s=(0,l.jsxs)("video",{controls:!0,width:n,height:"auto",children:[(0,l.jsx)("source",{src:i,type:"video/mp4"}),"Your browser does not support the video tag."]});break;default:s=(0,l.jsx)(t.FrV,{color:"white",size:70,n:!0})}return(0,l.jsx)("div",{className:"",children:s})}},39161:(e,s,a)=>{"use strict";a.d(s,{I:()=>d,L:()=>o});var t=a(11222),l=a(9910),i=a(73422);const n="".concat("https://desktopcrm.com:51/v1"),o=e=>async s=>{try{s((0,l.hb)());const a={headers:{"Content-Type":"application/json","x-access-token":e}};await t.A.get("".concat(n,"/user/calling/user-messages"),a).then((e=>{var a;if(console.log("\ud83d\ude80 ~ .then ~ response:",e),200!==(null===e||void 0===e||null===(a=e.data)||void 0===a?void 0:a.statusCode))return i.oR.error(e.data.message),s((0,l.xk)(e.data.message));s((0,l.ez)(e.data.data.messagesData))}))}catch(a){s((0,l.xk)(a.message))}},d=(e,s)=>async a=>{try{a((0,l.hb)());const o={headers:{"Content-Type":"application/json","x-access-token":e}};await t.A.post("".concat(n,"/user/calling/user-messages-logs"),s,o).then((e=>{var s;if(console.log("\ud83d\ude80 ~ .then ~ response:",e),200!==(null===e||void 0===e||null===(s=e.data)||void 0===s?void 0:s.statusCode))return i.oR.error(e.data.message),a((0,l.xk)(e.data.message));a((0,l.ez)(e.data.data.messagesData))}))}catch(o){a((0,l.xk)(o.message))}}},7033:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>D});var t=a(82483),l=a(16575),i=a(91965),n=a(710),o=a(56723);const d=e=>{let{rooms:s,onDataFromChild:a,messages:l,deleteChatRecord:d,onMessagesDataFromChild:r,updateChat:c}=e;const[u,h]=(0,t.useState)(""),[v,m]=(0,t.useState)([]),[p,x]=(0,t.useState)([]),{isLoading:f}=(0,i.d4)((e=>e.calling));(0,t.useMemo)((()=>{x(s),m(s)}),[s]);function j(e){const s=new Date(e),a=new Date,t=new Date(a);if(t.setDate(a.getDate()-1),s.toDateString()===a.toDateString())return"Today";if(s.toDateString()===t.toDateString())return"Yesterday";{const e={year:"numeric",month:"long",day:"numeric"};return s.toLocaleDateString("en-US",e)}}return(0,o.jsxs)("div",{children:[" ",(0,o.jsx)("form",{class:"aside-search",role:"search",children:(0,o.jsx)("input",{type:"text",class:"form-control",placeholder:"Search Chats",onKeyUp:e=>{if(""!==e.target.value||void 0!==e.target.value){const s=(null===v||void 0===v?void 0:v.length)>0&&(null===v||void 0===v?void 0:v.filter((s=>null===s||void 0===s?void 0:s.includes(e.target.value))));x(s)}else x(v)}})}),f?(0,o.jsx)(n.A,{}):(0,o.jsx)("ul",{class:"chat-contacts-list list-group list-group-flush",children:(null===p||void 0===p?void 0:p.length)>0?null===p||void 0===p?void 0:p.map(((e,s)=>{const t=null===l||void 0===l?void 0:l.filter((s=>s.room===e.name)),i=t[t.length-1];return(0,o.jsx)("li",{class:"list-group-item",onClick:()=>(e=>{var s;h(e),a(e);const t=null===l||void 0===l?void 0:l.filter((s=>s.to_phone===e||s.from_phone===e));r(t),null===(s=document.getElementById("dummy_avatar"))||void 0===s||s.scrollIntoView({behavior:"smooth",block:"end"})})(e),children:(0,o.jsxs)("div",{class:"media",children:[(0,o.jsx)("div",{class:"media-head",children:(0,o.jsx)("div",{class:"avatar avatar-sm avatar-primary position-relative avatar-rounded",children:(0,o.jsx)("span",{class:"initial-wrap",children:"C"})})}),(0,o.jsxs)("div",{class:"media-body",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{class:"user-name",children:e}),(0,o.jsx)("div",{class:"user-last-chat",children:null===e||void 0===e?void 0:e.phone})]}),(0,o.jsx)("div",{children:(0,o.jsx)("div",{class:"last-chat-time",children:null!==i&&void 0!==i&&i.created_at?j((null===i||void 0===i?void 0:i.created_at)||new Date):"..."})})]})]})},s)})):(0,o.jsx)("li",{children:"No rooms till."})})]})};var r=a(93970);const c=e=>{let{rooms:s,authUser:a,socket:t,onDataFromChild:l,messages:i,deleteChatRecord:n,updateChat:c,onMessagesDataFromChild:u,a2pVerified:h}=e;return(0,o.jsxs)("div",{children:[" ",(0,o.jsxs)("div",{class:"chatapp-aside",children:[(0,o.jsx)("header",{class:"aside-header",children:(0,o.jsxs)("h1",{className:"fs-5 fw-bold",children:[(0,o.jsx)("span",{className:"pe-2",children:(0,o.jsx)(r.YUX,{size:30,color:"#007D88"})}),"Conversation"]})}),(0,o.jsxs)("div",{"data-simplebar":!0,class:"aside-body",children:[(0,o.jsx)("div",{className:"alert alert-warning",children:h?(0,o.jsx)(o.Fragment,{}):(0,o.jsxs)("p",{children:["A2P Verfification is required for conversation in US/Canada.\xa0",(0,o.jsx)("a",{href:"#","data-bs-target":"#a2p-modal","data-bs-toggle":"modal",className:"text-underline",children:(0,o.jsx)("ins",{children:"Add Details"})})]})}),(0,o.jsx)(d,{rooms:s,authUser:a,socket:t,onDataFromChild:l,messages:i,onMessagesDataFromChild:u,deleteChatRecord:n,updateChat:c})]})]})]})};a(34304);var u=a(94690),h=a.n(u),v=a(28846),m=a(28100),p=a.n(m),x=a(56874),f=a(99492),j=a(49678),g=a(22598),b=(a(53572),a(55870)),y=a(48985),k=a(10802),w=a(73422);const _=e=>{let{messages:s,selectedRoom:a,authUser:l,socket:n,selectedMessages:d,a2pVerified:r}=e;const{me:c,call:u,callUser:m,sendTextMessage:_,callingDevice:C,setShowCall:S,setIsDialerOpen:A,setActiveCall:D,setUserState:E,setCallStatus:T,setIsDial:N,setShowContacts:U,setActiveCallSid:I,setInputValue:F}=(0,t.useContext)(f.d),[R,z]=(0,t.useState)(null),[B,V]=(0,t.useState)(null),{users:L}=(0,i.d4)((e=>e.user)),{balanceDetails:M}=(0,i.d4)((e=>e.balance)),{token:K,user:Y}=(0,i.d4)((e=>e.auth)),O=(0,i.wA)();(0,t.useEffect)((()=>{(null===d||void 0===d?void 0:d.length)>0&&document.getElementById("dummy_avatar").scrollIntoView({behavior:"smooth",block:"end"})}),[d]),(0,t.useEffect)((()=>{}),[R,l,m,u,c,K]),(0,t.useEffect)((()=>{(null===L||void 0===L?void 0:L.length)>0&&V(L)}),[L]),(0,t.useEffect)((()=>{K&&O((0,j.lo)(K))}),[K,O]),(0,t.useEffect)((()=>{const e=a.user_id_1===l.id?a.user_id_2:a.user_id_1;if((null===B||void 0===B?void 0:B.length)>0){const s=null===B||void 0===B?void 0:B.filter((s=>s.id===e));z(s[0])}}),[B,l,a]);const[P,X]=(0,t.useState)(null),[q,H]=(0,t.useState)([]),[Q,W]=(0,t.useState)(null),J=e=>{if(null!==(null===Y||void 0===Y?void 0:Y.phone)&&void 0!==(null===Y||void 0===Y?void 0:Y.phone)&&""!==(null===Y||void 0===Y?void 0:Y.phone))if(parseInt(null===M||void 0===M?void 0:M.credit)>0)if(null!==Q){if("Enter"===e.key||"click"===e.type){const e={from:{phone:l.phone,name:l.name,avatar:l.avatar,socket_id:l.socket_id,accountSid:null===l||void 0===l?void 0:l.accountSid,authToken:null===l||void 0===l?void 0:l.authToken},to:{phone:a},user_id:l.id,message:Q};null!==a&&void 0!==a&&a.includes("+1")&&!r?w.oR.warn("A2P verification is required for conversation in US/Canada."):_(e),W(null)}}else w.oR.error("Please write something in the message.");else w.oR.error("You have insufficient balance to send the message.");else w.oR.error("Please configure you number first, then you are able to send a message.")};(0,t.useEffect)((()=>{document.getElementById("dummy_avatar").scrollIntoView({behavior:"smooth",block:"end"}),p().config.update({accessKeyId:"AKIAX2CISY6LNJB3XTIK",secretAccessKey:"zA+9Ypk4sNqNl9HlY2zmBoEI4edXTEonDUwE2ZAU",region:"eu-west-2"});const e=new(p().S3);(async()=>{const s={Bucket:"jampackcrm"};try{const a=await e.listObjectsV2(s).promise();H(a.Contents)}catch(a){console.error("Error fetching objects:",a)}})()}),[]);const Z=async(e,s)=>{const a=new(p().S3),t={Bucket:e,Key:s};try{const e=await a.getObject(t).promise(),l=URL.createObjectURL(new Blob([e.Body])),i=document.createElement("a");i.href=l,i.setAttribute("download",s),document.body.appendChild(i),i.click(),document.body.removeChild(i)}catch(l){console.error("Error downloading file:",l)}},$=e=>null===q||void 0===q?void 0:q.filter((s=>s.Key===e));function G(e){return null===e||void 0===e?void 0:e.split(".").pop().toLowerCase()}function ee(e){const s=null===e||void 0===e?void 0:e.charAt(0),a=null===e||void 0===e?void 0:e.indexOf(" ");return{firstCharacter:s,characterAfterSpace:-1!==a?e.charAt(a+1):""}}return(0,o.jsxs)("div",{class:"chatapp-single-chat",children:[(0,o.jsxs)("header",{class:"chat-header",children:[(0,o.jsx)("a",{id:"back_user_list",class:"btn btn-sm btn-icon btn-flush-dark btn-rounded flush-soft-hover back-user-list",href:"/",children:(0,o.jsx)("span",{class:"icon",children:(0,o.jsx)("span",{class:"feather-icon",children:(0,o.jsx)("i",{"data-feather":"chevron-left"})})})}),(0,o.jsxs)("div",{class:"media",children:[(0,o.jsx)("div",{class:"media-head",children:(0,o.jsx)("div",{class:"avatar avatar-sm avatar-primary position-relative avatar-rounded",children:(0,o.jsx)("span",{class:"initial-wrap",children:"C"})})}),(0,o.jsx)("div",{class:"media-body",children:(0,o.jsxs)("div",{class:"user-name",children:[" ",a]})})]}),(0,o.jsx)(y.m_,{id:"call_user_button",place:"left",content:"Call To User"}),(0,o.jsx)("div",{className:"btn btn-primary rounded-circle btn-icon float-end",style:{marginRight:"30%"},onClick:()=>(e=>{const s=null===C||void 0===C?void 0:C.connect({To:e});s.on("accept",(s=>{console.log(s,"call accepted"),S(!0),A(!0),D(s),E("ON_CALL"),N(!1),U(!1),T("STARTED"),F(e),console.log("Call accepted");const a=s.parameters.CallSid;I(a)})),s.on("reject",(()=>{S(!1),E("READY"),N(!0),A(!1),U(!1),T(null),console.log("Call accepted")})),s.on("disconnect",(()=>{O((0,k.kS)(K,{accountSid:l.accountSid,authToken:l.authToken,user_id:l.id})),S(!1),A(!1),E("READY"),N(!0),U(!1),console.log("Call disconnected"),T(null)}))})(a),"data-tooltip-id":"call_user_button",children:(0,o.jsx)(v.Cab,{className:"pt-2",size:20})})]}),(0,o.jsx)("div",{"data-simplebar":!0,id:"chat_body",class:"chat-body",children:(0,o.jsx)("ul",{id:"dummy_avatar",class:"list-unstyled chat-single-list",children:(null===d||void 0===d?void 0:d.length)>0?d.map(((e,s)=>(null===e||void 0===e?void 0:e.from_phone)!==(null===l||void 0===l?void 0:l.phone)?(0,o.jsxs)("li",{class:"media received",children:[(0,o.jsx)("div",{class:"avatar avatar-sm avatar-primary position-relative avatar-rounded",children:(0,o.jsx)("span",{class:"initial-wrap",children:ee(a.firstname+" "+a.lastname).firstCharacter+ee(a.firstname+" "+a.lastname).characterAfterSpace})}),(0,o.jsx)("div",{class:"media-body",children:(0,o.jsxs)("div",{class:"msg-box",children:[(0,o.jsxs)("div",{children:[(null===e||void 0===e?void 0:e.file_key)&&(0,o.jsx)("button",{style:{border:"none",background:"none"},onClick:()=>{var s;return Z("jampackcrm",null===(s=$(e.file_key)[0])||void 0===s?void 0:s.Key)},children:(0,o.jsx)(x.A,{fileType:G(null===e||void 0===e?void 0:e.file_key),fileUrl:"https://s3.eu-west-2.amazonaws.com/jampackcrm/".concat(null===e||void 0===e?void 0:e.file_key)})}),(0,o.jsx)("p",{children:e.message}),(0,o.jsxs)("span",{class:"chat-time",children:[h()(null===Q||void 0===Q?void 0:Q.created_at).format("h:mm A"),(0,o.jsxs)("span",{className:"float-end",children:[" ",(null===e||void 0===e?void 0:e.file_key)&&((null===e||void 0===e?void 0:e.file_size)/1048576).toFixed(2)+" mb"]})]})]}),(0,o.jsxs)("div",{class:"msg-action",children:[(0,o.jsx)("a",{href:"/",class:"btn btn-icon btn-flush-dark btn-rounded flush-soft-hover no-caret",children:(0,o.jsx)("span",{class:"icon",children:(0,o.jsx)("span",{class:"feather-icon",children:(0,o.jsx)("i",{"data-feather":"corner-up-right"})})})}),(0,o.jsx)("a",{href:"/",class:"btn btn-icon btn-flush-dark btn-rounded flush-soft-hover dropdown-toggle no-caret","data-bs-toggle":"dropdown",children:(0,o.jsx)("span",{class:"icon",children:(0,o.jsx)("span",{class:"feather-icon",children:(0,o.jsx)("i",{"data-feather":"more-horizontal"})})})}),(0,o.jsxs)("div",{class:"dropdown-menu dropdown-menu-end",children:[(0,o.jsx)("a",{class:"dropdown-item",href:"/",children:"Forward"}),(0,o.jsx)("a",{class:"dropdown-item",href:"/",children:"Copy"})]})]})]})})]},s):(0,o.jsx)("li",{class:"media sent d-flex",children:(0,o.jsx)("div",{class:"media-body",style:{display:"flex"},children:(0,o.jsxs)("div",{className:"d-flex",children:[(0,o.jsx)("div",{class:"msg-box",children:(0,o.jsxs)("div",{children:[(null===e||void 0===e?void 0:e.file_key)&&(0,o.jsx)("button",{style:{border:"none",background:"none"},onClick:()=>{var s;return Z("jampackcrm",null===(s=$(e.file_key)[0])||void 0===s?void 0:s.Key)},children:(0,o.jsx)(x.A,{fileType:G(null===e||void 0===e?void 0:e.file_key),fileUrl:"https://s3.eu-west-2.amazonaws.com/jampackcrm/".concat(null===e||void 0===e?void 0:e.file_key)})}),(0,o.jsx)("p",{children:e.message}),(0,o.jsxs)("span",{class:"chat-time",children:[h()(null===Q||void 0===Q?void 0:Q.created_at).format("h:mm A"),(0,o.jsxs)("span",{className:"float-end",children:[" ",(null===e||void 0===e?void 0:e.file_key)&&((null===e||void 0===e?void 0:e.file_size)/1048576).toFixed(2)+" mb"]})]})]})}),(0,o.jsx)("div",{className:"",children:(null===(null===e||void 0===e?void 0:e.sid)||"Failed"===(null===e||void 0===e?void 0:e.status))&&(0,o.jsx)("div",{class:"media-head",children:(0,o.jsx)("div",{class:"avatar avatar-sm avatar-secondary position-relative avatar-rounded",children:(0,o.jsx)(b.A,{trigger:(0,o.jsx)("button",{className:"btn btn-icon btn-floating btn-secondary btn-lg btn-rounded shadow-lg",id:"dialer_button",children:(0,o.jsx)(g.eHT,{color:"red",size:"24",style:{marginTop:"-15%"}})}),position:"bottom right",children:(0,o.jsx)("p",{className:"",children:null===e||void 0===e?void 0:e.message_error})})})})})]})})},s))):(0,o.jsx)("li",{children:" No Messages"})})}),(0,o.jsxs)("footer",{class:"chat-footer d-flex gap-2",children:[(0,o.jsx)("div",{children:(0,o.jsx)("button",{className:"btn btn-secondary shadow rounded-circle  float-end",style:{width:"35px",height:"35px"},onClick:()=>document.getElementById("dummy_avatar").scrollIntoView({behavior:"smooth",block:"end"}),children:(0,o.jsx)(v.$TP,{style:{marginLeft:"-7px",marginBottom:"4px"}})})}),(0,o.jsx)("div",{class:"input-group",children:(0,o.jsxs)("span",{class:"input-affix-wrapper",children:[(0,o.jsx)("input",{type:"text",name:"send-msg",class:"input-msg-send form-control rounded-input",placeholder:"Type your message...",value:Q,onChange:e=>W(e.target.value),onKeyUp:e=>"Enter"===e.key&&J(e)}),(0,o.jsx)("span",{class:"input-suffix",children:(0,o.jsx)("button",{class:"btn btn-icon btn-flush-primary btn-rounded btn-send",onClick:e=>J(e),children:(0,o.jsx)("span",{class:"icon",children:(0,o.jsx)(v.QyA,{})})})})]})})]}),(0,o.jsx)("div",{class:"chat-info",children:(0,o.jsxs)("div",{"data-simplebar":!0,class:"nicescroll-bar",children:[(0,o.jsx)("button",{type:"button",class:"info-close btn-close",children:(0,o.jsx)("span",{"aria-hidden":"true",children:"\xd7"})}),(0,o.jsxs)("div",{class:"text-center",children:[(0,o.jsx)("div",{class:"avatar avatar-xxl avatar-rounded",children:(0,o.jsx)("img",{src:((null===a||void 0===a?void 0:a.user_id_1)===(null===l||void 0===l?void 0:l.id)?null===a||void 0===a?void 0:a.user_image_2:null===a||void 0===a?void 0:a.user_image_1)||"https://static.vecteezy.com/system/resources/previews/009/292/244/original/default-avatar-icon-of-social-media-user-vector.jpg",alt:"user",class:"avatar-img"})}),(0,o.jsxs)("div",{class:"cp-name text-truncate mt-2",children:[" ",a]}),(0,o.jsx)("p",{class:"text-truncate",children:"No phone calls Always busy"})]}),(0,o.jsx)("div",{class:"tab-content mt-4",children:(0,o.jsx)("div",{class:"tab-pane fade show active",id:"tab_info",children:(0,o.jsx)("div",{class:"collapse-simple mt-3"})})})]})})]})};var C=a(68335),S=a(39161);const A=()=>{const e="https://desktopcrm.com:51",{messagesArray:s}=(0,t.useContext)(f.d),[a,l]=(0,t.useState)({}),{messages:n}=(0,i.d4)((e=>e.message)),{conversations:d}=(0,i.d4)((e=>e.calling)),r=(0,t.useMemo)((()=>(0,C.Ay)(e)),[e]),[u,h]=(0,t.useState)(null),[v,m]=(0,t.useState)([]),[p,x]=(0,t.useState)([]),{user:j,token:g}=(0,i.d4)((e=>e.auth)),[b,y]=(0,t.useState)(!1),w=(0,i.wA)();(0,t.useEffect)((()=>{m(n)}),[n]),(0,t.useEffect)((()=>{w((0,k.BQ)(g,{authToken:null===j||void 0===j?void 0:j.authToken,accountSid:j.accountSid})),w((0,S.L)(g))}),[g,w,j]),(0,t.useEffect)((()=>{x(d)}),[d]),(0,t.useEffect)((()=>{m(s);const e=(null===s||void 0===s?void 0:s.length)>0&&(null===s||void 0===s?void 0:s.filter((e=>e.from_phone===(null===j||void 0===j?void 0:j.phone)&&e.to_phone===(null===u||void 0===u?void 0:u.to_phone)&&e.user_id===(null===j||void 0===j?void 0:j.id)||e.to_phone===(null===j||void 0===j?void 0:j.phone)&&e.from_phone===(null===u||void 0===u?void 0:u.from_phone)&&e.user_id===(null===j||void 0===j?void 0:j.id))));l(e)}),[s]);return(0,o.jsx)("div",{children:(0,o.jsx)("div",{class:"hk-pg-wrapper pb-0",children:(0,o.jsx)("div",{class:"hk-pg-body py-0",children:(0,o.jsx)("div",{class:"chatapp-wrap chatapp-info-active",children:(0,o.jsxs)("div",{class:"chatapp-content",children:[(0,o.jsx)(c,{socket:r,a2pVerified:b,rooms:p,messages:v,onFilterDataFromChild:e=>{},authUser:j,onDataFromChild:e=>{h(e)},onMessagesDataFromChild:e=>{console.log("\ud83d\ude80 ~ handleMessagesDataFromChild ~ data:",e),l(e)}}),null!==u&&(0,o.jsx)(_,{messages:v,a2pVerified:b,selectedRoom:u,selectedMessages:a,authUser:j,socket:r})]})})})})})},D=()=>(0,o.jsx)("div",{children:(0,o.jsx)(l.A,{component:(0,o.jsx)(A,{})})})},11976:()=>{}}]);
//# sourceMappingURL=2816.8de41cbd.chunk.js.map